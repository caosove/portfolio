<%@page import="dev.UserDAO"%>
<%@page import="dev.UserDTO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>

<%
	request.setCharacterEncoding("UTF-8");

	if(request.getMethod().equals("GET")){
		response.sendRedirect(request.getContextPath()+"/login_index.jsp");
		return;
	}
	
	String id=request.getParameter("login-id");
	String pwd=request.getParameter("login-pw");
	
	//System.out.println(id);
	//System.out.println(pwd);
	
	UserDTO loginUser=UserDAO.getDAO().getUser(id);
	
	String jsSrc="<script type=\"text/javascript\"> frame.classList.toggle(\"show-login-content\"); loginId.focus();</script>";
	
	 if(loginUser==null){
		session.setAttribute("login_msg", "아이디가 존재하지 않습니다.");
		session.setAttribute("id", id);
		session.setAttribute("jsSrc", jsSrc);
		response.sendRedirect(request.getContextPath()+"/login_index.jsp"); 
	 	return ;
	}

	 if(loginUser.getuGrade().equals("drop")){
		session.setAttribute("login_msg", "아이디가 존재하지 않습니다.");
		session.setAttribute("id", id);
		session.setAttribute("jsSrc", jsSrc);
		response.sendRedirect(request.getContextPath()+"/login_index.jsp");
		return;
	}
	 
	if(!pwd.equals(loginUser.getuPwd())){
		session.setAttribute("login_msg", "아이디 또는 비밀번호가 맞지 않습니다.");
		session.setAttribute("id", id);
		session.setAttribute("jsSrc", jsSrc);
		response.sendRedirect(request.getContextPath()+"/login_index.jsp");
		return;
	}
	
	
	
	session.setAttribute("loginUser", loginUser);
	
	 String uri=(String)session.getAttribute("uri");
	if(uri==null){  
		response.sendRedirect(request.getContextPath()+"/login_index.jsp");
	} else{ 
		session.removeAttribute("uri");
		response.sendRedirect(uri);
	} 
	
%>